<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Student Submitted Events</title>
	<link rel="stylesheet" href="stud_events.css">
</head>
<body>
	<h1>Your Submitted Events</h1>
	<!-- Filter Dropdown -->
	<label for="filterDropdown">Filter Events:</label>
	<select id="filterDropdown">
		<option value="all">All Events</option>
		<option value="lastWeek">Events in Last Week</option>
		<option value="lastMonth">Events in Last Month</option>
		<option value="lastSixMonths">Events in Last 6 Months</option>
	</select>
	<!-- Events Container -->
	<div id="eventsContainer">
		<!-- Submitted events will be dynamically loaded here -->
	</div>

	<script>
		// Function to format date as "dd MMM yyyy"
function formatDate(dateString) {
	const options = { day: '2-digit', month: 'short', year: 'numeric' };
	return new Date(dateString).toLocaleDateString('en-GB', options);
}

document.addEventListener("DOMContentLoaded", function () {
	// Check if the user is authenticated
	fetch('/api/check-auth')
		.then(response => {
			if (response.status === 401) {
				// Redirect to index.html if not authenticated
				window.location.href = 'index.html';
			} else if (response.ok) {
				// Load submitted events with the selected filter
				loadSubmittedEvents();
			}
		})
		.catch(error => {
			console.error('Error checking authentication:', error);
			window.location.href = 'index.html';
		});

	// Load submitted events with optional filtering
	function loadSubmittedEvents(filter = 'all') {
		fetch(`/api/submitted-events?filter=${filter}`)
			.then(response => {
				if (!response.ok) {
					console.error('Failed to fetch:', response.statusText);
				}
				return response.json();
			})
			.then(events => {
				const eventsContainer = document.getElementById('eventsContainer');
				eventsContainer.innerHTML = ''; // Clear previous events

				events.forEach(event => {
					const eventDiv = document.createElement('div');
					eventDiv.classList.add('event');

					// Generate link for certificate
					const certificateLink = event.certificate 
						? `<a href="/api/certificate/${event.event_id}" target="_blank">Download/View Certificate</a>`
						: 'Certificate not available';

					// Populate event details
					eventDiv.innerHTML = `
						<strong>${event.name}</strong> <br>
						${formatDate(event.start_date)} <br>
						<span>Start Time: ${event.start_time}</span> <br>
						${formatDate(event.end_date)} <br>
						<span>End Time: ${event.end_time}</span> <br>
						Points: ${event.points}, Fee: ${event.fee} <br>
						Venue: ${event.venue} <br>
						<a href="${event.link}" target="_blank">Event Link</a> <br>
						${certificateLink}
					`;

					eventsContainer.appendChild(eventDiv);
				});
			})
			.catch(error => console.error('Error fetching submitted events:', error));
	}

	// Dropdown filter logic
	const filterDropdown = document.getElementById('filterDropdown');
	filterDropdown.addEventListener('change', () => {
		const selectedFilter = filterDropdown.value;
		loadSubmittedEvents(selectedFilter); // Load events based on selected filter
	});
});

	</script>
</body>
</html>
